---
- type: replace
  path: /instance_groups/name=database/jobs/-
  value:
    release: routing
    name: route_registrar
    consumes:
      nats: {from: nats, deployment: cf}
    properties:
      route_registrar:
        routes:
        - name: cf-mysql-proxy
          port: 8080
          registration_interval: 10s
          uris:
          - &proxy_base_uri proxy.((system_domain))
          prepend_instance_index: true
        - name: cf-mysql-proxy-aggregator
          port: 8082
          registration_interval: 10s
          uris:
          - *proxy_base_uri

- type: replace
  path: /instance_groups/name=database/jobs/name=proxy/properties/api_uri?
  value: *proxy_base_uri

- type: replace
  path: /variables/name=galera_server_certificate/options/common_name?
  value: galera_server_certificate

- type: replace
  path: /instance_groups/name=database/jobs/name=bootstrap/consumes?/mysql
  value:
    from: mysql-clustered

- type: replace
  path: /instance_groups/name=database/jobs/name=mysql-clustered/provides?/mysql
  value:
    as: mysql-clustered
